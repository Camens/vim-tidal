#!/bin/bash

# Get current directory (of script)
# http://stackoverflow.com/questions/59895/can-a-bash-script-tell-what-directory-its-stored-in
SOURCE="${BASH_SOURCE[0]}"
while [ -h "$SOURCE" ]; do # resolve $SOURCE until the file is no longer a symlink
  DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"
  SOURCE="$(readlink "$SOURCE")"
  [[ $SOURCE != /* ]] && SOURCE="$DIR/$SOURCE" # if $SOURCE was a relative symlink, we need to resolve it relative to the path where the symlink file was located
done
DIR="$( cd -P "$( dirname "$SOURCE" )" && pwd )"

#SOCKET=tidal
SESSION=tidal

# check if tmux session "tidal" is running, attach only
# else, create new session, split windows and run processes

tmux has-session -t $SESSION 2>/dev/null

if [ "$?" -eq 1 ] ; then
  tmux \
    new-session -s $SESSION   \; \
    send-keys "cd ~/tidal" C-m "vim foo.tidal" C-m  \; \
    split-window -h -t $SESSION   \; \
    send-keys -t 1 "ghci -XOverloadedStrings" C-m   \; \
    split-window -v -t $SESSION   \; \
    send-keys -t 2 "cd ~/dirt" C-m "./dirt" C-m   \; \
    load-buffer $DIR/../BootTidal.hss   \; \
    paste-buffer -d -t 1  \; \
    select-pane -t 0
else
  tmux attach-session -t $SESSION
fi
